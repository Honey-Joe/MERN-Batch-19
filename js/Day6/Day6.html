<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <!--FireBase SDK-->
    <script
      defer
      src="https://www.gstatic.com/firebasejs/8.10.1/firebase.js"
    ></script>
    <script
      defer
      src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"
    ></script>
    <script
      defer
      src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"
    ></script>
  </head>
  <body>
    <div class="2xl:container mx-auto">
      <div class="w-[90%] mx-auto flex justify-center items-center h-screen">
        <div
          class="flex flex-col gap-5 items-center border shadow-lg p-5 rounded-lg"
        >
          <h1 class="font-bold text-2xl">Login</h1>
          <hr class="h-[0.1rem] w-full bg-black" />
          <form class="flex flex-col gap-5" id="form">
            <div class="flex flex-col gap-2">
              <label for="email">Email:</label>
              <input
                type="text"
                name="email"
                id="email"
                class="py-2 pr-16 pl-3 rounded-lg outline-none border border-black"
                placeholder="Enter your email...."
              />
              <p id="emailError" class="text-sm text-red-600"></p>
            </div>
            <div class="flex flex-col gap-2">
              <label for="password">password:</label>
              <input
                type="text"
                name="pass"
                id="pass"
                class="py-2 pr-16 pl-3 rounded-lg outline-none border border-black"
                placeholder="Enter your password..."
              />
              <p id="passError" class="text-sm text-red-600"></p>
            </div>

            <div>
              <button
                class="py-2 w-full bg-green-600 text-white rounded-lg hover:bg-white hover:border hover:border-green-600 border border-green-600 hover:text-green-600"
              >
                Submit
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      var form = document.getElementById("form");
      var email = document.getElementById("email");
      var pass = document.getElementById("pass");

      var emailError = document.getElementById("emailError");
      var passError = document.getElementById("passError");

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const valid = advancedValidation(email.value, pass.value);

        if (valid) {
          saveData(email.value, pass.value);
          console.log("Data send to the DB");
        } else {
          console.log("Data is not valid");
        }
      });

      const saveData = (email, pass) => {
        const firebaseConfig = {
          apiKey: "AIzaSyCmmrnLpEJojAtFveROkMK3ZpVarf5uptQ",
          authDomain: "mernb19db.firebaseapp.com",
          databaseURL:
            "https://mernb19db-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "mernb19db",
          storageBucket: "mernb19db.firebasestorage.app",
          messagingSenderId: "1006629555624",
          appId: "1:1006629555624:web:1a58623b39b7e373f1619d",
        };

        firebase.initializeApp(firebaseConfig)
        const db = firebase.database().ref("ReqForm");

        db.push({
          email: email,
          password: ppass,
        });
      };

      const advancedValidation = (email, pass) => {
        const emailRegex = /^\S+@\S+\.\S+$/;
        const passRegex =
          /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/;

        var isValid = true;

        if (email.match(emailRegex)) {
          console.log("valid");
          emailError.textContent = "";
        } else {
          console.log("Invalid");
          emailError.textContent = "Invalid Eamil format";
          isValid = false;
        }

        if (pass.match(passRegex)) {
          console.log("Pass valid");
          passError.textContent = "";
        } else {
          console.log("Pass invalid");
          passError.textContent = "Invalid pass format";
          isValid = false;
        }

        return isValid;
      };

      email.addEventListener("input", (e) => {
        const emailRegex = /^\S+@\S+\.\S+$/;

        if (e.target.value == "") {
          emailError.textContent = "Required";
        } else if (!e.target.value.match(emailRegex)) {
          emailError.textContent = "Email is not in a format";
        } else {
          emailError.textContent = "";
        }
      });

      pass.addEventListener("input", (e) => {
        const CharRegex = /(?=.*?[#?!@$%^&*-])/;
        const passRegex =
          /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/;

        if (e.target.value == "") {
          passError.textContent = "Required";
        } else if (!e.target.value.match(CharRegex)) {
          passError.textContent = "Atleast one spl character";
        } else if (!e.target.value.match(passRegex)) {
          passError.textContent = "Pass must in the format Coding@123";
        } else {
          passError.textContent = "";
        }
      });
    </script>
  </body>
</html>
